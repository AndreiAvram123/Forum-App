static def getPropertiesFromEnvironmentVariables(Properties properties) {
    properties.setProperty("keyAlias", System.getenv("BITRISEIO_ANDROID_KEYSTORE_ALIAS"))
    properties.setProperty("keyPassword", System.getenv("BITRISEIO_ANDROID_KEYSTORE_PRIVATE_KEY_PASSWORD"))
    properties.setProperty("storeFile", System.getenv("BITRISE_KEY_DOWNLOAD_PATH"))
    properties.setProperty("storePassword", System.getenv("BITRISEIO_ANDROID_KEYSTORE_PASSWORD"))
}

ext.getKeystoreProperties = { filename ->
    def properties = new Properties()
    properties.setProperty("keyAlias", "")
    properties.setProperty("keyPassword", "")
    properties.setProperty("storeFile", "")
    properties.setProperty("storePassword", "")

    try {
        def propsFile = rootProject.file(filename)
        if (propsFile.exists()) {
            properties.load(new FileInputStream(propsFile))
        } else {
            getPropertiesFromEnvironmentVariables(properties)
        }
    } catch (Exception e) {
        properties = null
        println 'Unable to read keystore'
    }
    return properties
}

